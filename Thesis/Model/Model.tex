% !TeX root = ../Thesis.tex

\chapter{A New Model}
\section{Components}

\subsection{Gain}
Within the Er-doped gain fibre, the gain term is dominant, and equation~\eqref{eq:nlse} reduces to
\begin{align}
\label{eq:gainde}
\pdiff{A}{z} &= \frac{1}{2} g(A),
\end{align}
where $g(A)$ takes the form \cite{bohun, burgoyne2014, peng, shtyrina, silfvast, yarutkina}
\begin{align}
\label{eq:energy}
	g(A) &= \frac{g_0}{1 + E / \Es} A,& E &= \int_{-\infty}^\infty |A|^2 \, \df T,
\end{align}
where $g_0$ is a small signal gain, $E$ is the energy of the pulse, and $\Es$ is the energy at which the gain begins to saturate.
Multiplying~\eqref{eq:gainde} by $\bar{A}$, the complex conjugate of $A$, yields
\begin{align*}
	\bar{A} \pdiff{A}{z} = \frac{1}{2}\frac{g_0 |A|^2}{1 + E / \Es},
\end{align*}
adding this to its complex conjugate and integrating over $T$ gives
%\begin{align*}
%	\diff{|A|^2}{z} &= \frac{g_0 |A|^2}{1 + E / \Es}.
%\end{align*}
%After integrating this becomes
\begin{align}
\label{diffez}
	\diff{E}{z} &= \frac{g_0 E}{1 + E / \Es}.
\end{align}
For $E \ll \Es$ the energy grows exponentially, whereas for $E \gg \Es$ the gain has saturated and so the growth is linear. To obtain a closed form solution, \eqref{diffez} is integrated over a gain fibre of length $z$ and assuming the energy increases from $E$ to $E_{\textrm{out}}$, then
\begin{align*}
	g_0 z = \log\frac{E_{\textrm{out}}}{E} + \frac{E_{\textrm{out}}-E}{\Es},
\end{align*}
and by exponentiating, rearranging, and applying $W$, the Lambert $W$ function\footnote{see Appendix \ref{chap:lambertw}},
\begin{align*}
W\left(\frac{E}{\Es} \textrm{e}^{E/\Es} \textrm{e}^{g_0 z}\right) &= W\left(\frac{E_{\textrm{out}}}{\Es} \textrm{e}^{E_{\textrm{out}}/\Es}\right) \\
&= \frac{E_{\textrm{out}}}{\Es},
\end{align*}
by \eqref{eq:lambertw}. This results in the closed form expression
\begin{align*}
E_{\textrm{out}}(z) = \Es W \left( \frac{E}{\Es} \textrm{e}^{E/\Es} \textrm{e}^{g_0 z} \right)
\end{align*}
with the desired property that $E_{\textrm{out}}(0)=E$. Furthermore, since $E \sim |A|^2$, the gain in terms of the amplitude is given by
\begin{align*}
G(A;E) &= \left(\frac{E_{\textrm{out}}(L_g)}{E}\right)^{1/2}A \\
&= \left( \frac{\Es}{E} W \left( \frac{E}{\Es} \textrm{e}^{E/\Es} \textrm{e}^{g_0 L_g} \right) \right)^{1/2} A,
\end{align*}
where $L_g$ is the length of the gain fibre.

\subsection{Fibre Nonlinearity}
The nonlinearity of the fibre arises from the parameter $\gamma$; in regions where this affect is dominant expression~\eqref{eq:nlse} becomes
\begin{align}
\label{eq:fibrediff}
	\pdiff{A}{z} - i \gamma |A|^2 A = 0.
\end{align}
This expression can be manipulated in a similar manner to the gain to show $\frac{\partial}{\partial z} |A|^2 = 0$, suggesting that $A(T,z) = A_0(T) e^{i \varphi(T,z)}$. Substituting this representation into~\eqref{eq:fibrediff} and setting $\varphi(T,0)=0$ gives $\varphi(T,z) = \gamma |A|^2 z$. For a fibre of length $L_f$ the effect of the nonlinearity is thus
\begin{align*}
F(A) &= A e^{i \gamma |A|^2 L_f}.
\end{align*}

\subsection{Loss}
Two sources of loss exist within the laser circuit: the loss due to the output coupler and the optical loss due to absorption and scattering. Combining these two effects give a loss that takes the form
\begin{align*}
L(A) &= (1 - R) e^{- \alpha L}A,
\end{align*}
where $R$ is the reflectivity of the output coupler, and $L$ is the total length of the laser circuit.

\subsection{Dispersion}
Within the laser cavity, the dispersion is dominated by the CFBG. In comparison, the dispersion due to the fibre is negligible. The dispersive terms of \eqref{eq:nlse} give
\begin{align}
\label{eq:dispde}
	\pdiff{A}{z} = -i \frac{\beta_2}{2} \pdiff[2]{A}{T} + \frac{\beta_3}{6} \pdiff[3]{A}{T},
\end{align}
and since dispersion acts in the frequency domain it is convenient to take the Fourier transform of~\eqref{eq:dispde} \cite{gradshteyn}, giving
\begin{align*}
	\pdiff{}{z}\FT{A} &= i\frac{\omega^2}{2}\left(\beta_2 - \frac{\beta_3}{3} \omega\right) \FT{A}.
\end{align*}
The effect of dispersion is then
\begin{align*}
D(A) &= \FTi{\textrm{e}^{i \omega^2 L_D(\beta_2 - \beta_3 \omega/3)/2} \FT{A}}.
\end{align*}
For a highly dispersive media the third order effects may need to be considered~\cite{agrawal2013, litchinitser}. However, for simplicity and because of the nature of the grating, the third order effects will be neglected \cite{agrawal2013, ferreira}---we set $\beta_3=0$ for the subsequent analysis.

\subsection{Modulation}
In the average model, the amount of modulation is characterized by the parameter $\epsilon$ through the term $\frac{\epsilon}{2}T^2 A$. In this new model, the modulation is considered to be applied externally through its action on the spectrum and for simplicity the representation is taken as the Gaussian
\begin{align*}
M(A) &= \textrm{e}^{-T^2 / 2 T_M^2} A,
\end{align*}
where $T_M$ is a characteristic width of the modulation.

\section{Non-Dimensionalization}

\begin{table}
\begin{center}
\begin{tabular}{lclc}
Parameter & Symbol & Value & Sources \\
\noalign{\global\arrayrulewidth=1.5pt}\hline
Absorption of Fibre & $\alpha$ & $0.01$--$0.3\text{ m}^{-1}$  & \cite{burgoyneemail, shtyrina, yarutkina} \\
Fibre Dispersion & $\beta_2^f$ & $-50$--$50 \text{ ps}^2/ \text{km}$ & \cite{agrawal2013, burgoyne2014, litchinitser, peng, yarutkina} \\
Fibre Nonlinearity & $\gamma$ & $0.001$--$0.01 \text{ W}^{-1} \text{m}^{-1}$ & \cite{agrawal2013, yarutkina} \\
Grating Dispersion & $\beta_2^g L_D$ & $10$--$2000 \text{ ps}^2$ & \cite{agrawal2002, agrawal2013, burgoyne2014, li} \\
Length of Cavity & $L$ & $10$--$100 \text{ m}$ & \cite{burgoyneemail, peng} \\
Length of Fibre & $L_f$ & $0.15$--$1 \text{ m}$ & \cite{burgoyneemail} \\
Length of Gain Fibre & $L_g$ & $2$--$3 \text{ m}$ & \cite{burgoyne2014, peng, shtyrina, yarutkina} \\
Modulation Time & $T_M$ & $15$--$150 \text{ ps}$ & \cite{bohun, burgoyne2014, burgoyneemail} \\
Reflectivity of Optical Coupler & $R$ & $0.1$--$0.9$ & \cite{burgoyneemail, peng} \\
Saturation Energy & $\Es$ & $10^3$--$10^4 \text{ pJ}$ & \cite{burgoyneemail, yarutkina} \\
Small Signal Gain & $g_0$ & $1$--$10 \text{ m}^{-1}$ & \cite{burgoyneemail, yarutkina} \\
\hline
\end{tabular}
\caption{Orders of magnitude of various parameters.}
\label{tab:values}
\end{center}
\end{table}

%\begin{figure}[tbp]
%\centering
%\begin{subfigure}[]{\columnwidth}
%\input{Shape}
%\caption{Envelope}
%\label{fig:envelope}
%\end{subfigure} \\
%\begin{subfigure}[]{\columnwidth}
%\input{Transform}
%\caption{Fourier Transform}
%\label{fig:fourier}
%\end{subfigure} \\
%\begin{subfigure}[]{\columnwidth}
%\input{Chirp}
%\caption{Chirp}
%\end{subfigure}
%\caption{Simulation with $s = 0.09$, $a = 8 \times 10^3$, $h = 0.04$, and $E_0 = 0.1$ with $A_0 = \Gamma \sech{(2T)} \textrm{e}^{i \pi / 4}$. $\Gamma$ is chosen such that $\int_{-\infty}^\infty |A|^2 \, \textrm{d}T = E_0$, and hyperbolic secant is chosen since it is a common soliton. In the stable case $b = 1.32$, whereas for the broken case $b = 1.25$. The pulses are shown after 25 iterations.}
%\label{fig:pulse}
%\end{figure}

The structure of each process of the laser can be better understood by re-scaling the time, energy, and amplitude. Specifically, the time shall be scaled by the characteristic modulation time which is related to the pulse duration, the energy by the saturation energy, and the amplitude will be scaled so that it is consistent:
\begin{align*}
	T &= T_M \widetilde{T},& E &= \Es \widetilde{E},& A &= \left( \frac{\Es}{T_M} \right)^{1/2} \widetilde{A}.
\end{align*}
The new process maps, after dropping the tildes, become
\begin{subequations}
\begin{align}
\label{eq:gain}
G(A) &= \left(E^{-1} W \left( a E \textrm{e}^{E}\right) \right)^{1/2} A, \\
\label{eq:fibre}
F(A) &= A \textrm{e}^{i b |A|^2}, \\
\label{eq:loss}
L(A) &= h A, \\
\label{eq:disp}
D(A) &= \FTi{\textrm{e}^{i s^2 \omega^2} \FT{A}}, \\
\label{eq:mod}
M(A) &= \textrm{e}^{-T^2 / 2} A,
\end{align}
\end{subequations}
with the four dimensionless parameters (see Table~\ref{tab:values})
\begin{align*}
	a &= \textrm{e}^{g_0 L_g} \sim 8 \times 10^3,& s &= \sqrt{\frac{\beta_2 L_D}{2 T_M^2}} \sim 0.2, \\
	b &= \gamma L_f \frac{\Es}{T_M} \sim 1,& h &= (1 - R) \textrm{e}^{-\alpha L} \sim 0.04,
\end{align*}
which control the behaviour of the laser.

\section{Combining the Effects}
In this model the pulse is iteratively passed through each process, the order of which must now be considered. We are most interested in the output of the laser cavity, and so we shall start with the loss component. Next the pulse is passed though the CFBG, as well as the modulator. Finally, the pulse travels through the gain fibre to be amplified, and then we consider the effect of the nonlinearity since this is the region where the power is maximized. The pulse after one complete circuit of the laser cavity is then passed back in to restart the process. Functionally this can be denoted as
\begin{align*}
	\mathcal{L}(A) = F(G(M(D(L(A))))),
\end{align*}
where $\mathcal{L}$ is one loop of the laser. A solution to this model is one in which the envelope and chirp are unchanged after traversing every component in the cavity, that is, such that $\mathcal{L}(A) = A \textrm{e}^{i \phi}$---for some $\phi \in \mathbb{R}$.

\section{Solution to the Linear Model}
\label{sec:linear}
In the case of $b = 0$---which shall be referred to as the linear model---a solution can be found analytically. It is expected the solution will take the form of a Gaussian. There are a few reasons for this; the solution to the average model is a Gaussian, the equilibrium shape will be highly correlated to the shape of the modulation function ***, and since a Gaussian is a fixed point of the Fourier transform \cite{gradshteyn} dispersion will not alter the envelope. \\

Consider the initial pulse
\begin{align*}
	A_0 = \sqrt{P} \exp \left( -(1 + iC) \frac{T^2}{2 \sigma^2} \right) \textrm{e}^{i \phi_0},
\end{align*}
where $P$ is the peak power, $C$ is the chirp, $\sigma^2$ is the variance, and $\phi_0$ is the initial phase. After passing though the optical coupler the pulse will simply decay to $A_1 = h A_0$. The pulse then enters the CFBG, where it will maintain its Gaussian shape, however, it will spread \cite{agrawal2013, ferreira, silfvast}. This can be written as
\begin{align*}
A_2 = \sqrt{P} h \zeta \exp \left( -(1 + i \widetilde{C}) \frac{T^2}{2 \widetilde{\sigma}^2} \right) \textrm{e}^{i(\phi_0 + \phi)},
\end{align*}
where $\widetilde{\sigma}^2$ denotes the resulting variance, $\widetilde{C}$ denotes the resulting chirp, and $\zeta$ is the reduction of the amplitude caused by the spread. Next, the pulse is modulated:
\begin{align*}
A_3 = \sqrt{P} h \zeta \exp \left( -(1 + i \widetilde{C}) \frac{T^2}{2 \widetilde{\sigma}^2} - \frac{T^2}{2} \right) \textrm{e}^{i(\phi_0 + \phi)}.
\end{align*}
Finally, the pulse travels though the gain fibre where it is amplified to
\begin{align*}
A_4 = \sqrt{P} \left( \frac{W(a E \textrm{e}^E)}{E} \right)^{1/2} h \zeta \exp \left( -(1 + i \widetilde{C}) \frac{T^2}{2 \widetilde{\sigma}^2} - \frac{T^2}{2} \right) \textrm{e}^{i(\phi_0 + \phi)},
\end{align*}
with $E$ the energy of the pulse as it enters the gain fibre. \\

In equilibrium it must be that $A_0 = A_4 \textrm{e}^{-i \phi}$. More explicitly, this gives three conditions:
\begin{subequations}
\begin{align}
\label{eq:energycond}
1 &= \left( \frac{W(a E \textrm{e}^E)}{E} \right)^{1/2} h \zeta, \\
\label{eq:varcond}
\frac{1}{\sigma^2} &= \frac{1}{\widetilde{\sigma}^2} + 1, \\
\label{eq:chirpcond}
\frac{C}{\sigma^2} &= \frac{\widetilde{C}}{\widetilde{\sigma}^2}.
\end{align}
\end{subequations}

\subsection{Equilibrium Shape}
Each of these processes has a relatively straight forward effect, with the exception of dispersion. After dispersion, the out-going variance, $\widetilde{\sigma}^2$, can be found by computing the effect of dispersion given by \eqref{eq:disp}. This yields the relations
\begin{subequations}
\begin{align}
\label{eq:varout}
\widetilde{\sigma}^2 \sigma^2 &= \left( \sigma^2 + 2 C s^2 \right)^2 + 4s^4, \\
\label{eq:chirpout}
\widetilde{C} &= C + (1+C^2) \frac{2 s^2}{\sigma^2}, \\
\label{eq:phase}
\phi &= \frac{1}{2} \arctan \left( \frac{2s^2}{\sigma^2 + 2C s^2} \right), \\
\zeta &= \left( \frac{\sigma}{\widetilde{\sigma}} \right)^{1/2}
\end{align}
\end{subequations}
for the variance, chirp, phase shift, and spread, respectively, after the dispersive element, the full details can be found in Appendix \ref{chap:disp}. Now, the out-going variance and chirp can be eliminated from this system of equations using \eqref{eq:varcond} and \eqref{eq:chirpcond}:
\begin{align*}
\widetilde{\sigma}^2 &= \frac{\sigma^2}{1 - \sigma^2}, \\
\widetilde{C} &= C \frac{1}{1 - \sigma^2}.
\end{align*}
Combining this first expression with \eqref{eq:varout} and expanding, we have that
\begin{align*}
\frac{\sigma^4}{1 - \sigma^2} = \sigma^4 + 4 C^2 s^4 + 4 C s^2 \sigma^2 + 4s^4,
\end{align*}
or written as a polynomial in $\sigma$,
\begin{align*}
0 = \sigma^6 + 4 C s^2 \sigma^4 + \left( 4s^4 (C^2 + 1) - 4 C s^2 \right) \sigma^2 - 4s^4 (C^2 + 1).
\end{align*}
The chirp can now be eliminated using \eqref{eq:chirpout}, the $1+C^2$ can be reduced in order by noticing that
\begin{align*}
C \frac{1}{1 - \sigma^2} &= C + (1 + C^2) \frac{2s^2}{\sigma^2}, \\
1 + C^2 &= \frac{\sigma^4}{2s^2(1 - \sigma^2)} C.
\end{align*}
Furthermore, the chirp can be completely eliminated since
\begin{align}
\nonumber
C &= \frac{\sigma^4}{2s^2(1 - \sigma^2)} \pm \sqrt{\frac{\sigma^8}{16s^4(1 - \sigma^2)^2} - 1}, \\
\label{eq:equilchirp}
&= \frac{\sigma^4 \pm \sqrt{\sigma^8 - 16s^4(1 - \sigma^2)^2}}{4s^2(1 - \sigma^2)}.
\end{align}
After simplifying algebraically, we arrive at
\begin{align*}
0 &= \sigma^6 \pm \sqrt{\sigma^8 - 16s^4(1 - \sigma^2)^2}(2 - \sigma^2), \\
\frac{\sigma^6}{2 - \sigma^2} &= \mp \sqrt{\sigma^8 - 16s^4(1 - \sigma^2)^2}.
\end{align*}
As we shall see, $\sigma$ is strictly less than $1$ at equilibrium, and so, notice that the left hand side of this expression is strictly positive. Therefore, only the negative root of \eqref{eq:equilchirp} will yield a solution. After squaring each side of this expression we obtain
\begin{align*}
\sigma^{12} = \sigma^8 (2 - \sigma^2)^2 - 16s^4 (1 - \sigma^2)^2 (2 - \sigma^2)^2,
\end{align*}
which once fully simplified, yields the biquartic equation
\begin{align*}
\left( \sigma^2 \right)^4 + 4 s^4 \left( \sigma^2 \right)^3 - 20 s^4 \left( \sigma^2 \right)^2 + 32 s^4 \left( \sigma^2 \right) - 16 s^4 = 0.
\end{align*}
Since this is a quartic in $\sigma^2$ this can be solved analytically; the (positive, real) solution is
\begin{align}
\label{eq:equilvar}
\sigma^2 &= \sqrt{2} s \left( s^6 + 3s^2 + \sqrt{4 + s^4} \left( 1 + s^4 \right) \right)^{1/2} - s^4 - s^2 \sqrt{4 + s^4}.
\end{align}

Limit?***

\subsection{Equilibrium Energy}
From~\eqref{eq:energycond} the equilibrium energy can be found, as well as the equilibrium peak power. This relation can be simplified by squaring both sides and rearranging to give
\begin{align*}
\frac{1}{h^2 \zeta^2} E = W \left( a E \textrm{e}^E \right).
\end{align*}
Then, by taking the exponential of each side, and multiplying by this expression, we obtain\footnote{By \eqref{eq:lambertw}.}
\begin{align*}
\frac{1}{h^2 \zeta^2} E \exp \left(\frac{1}{h^2 \zeta^2} E \right) &= W \left( a E \textrm{e}^E \right) \exp \left( W \left( a E \textrm{e}^E \right) \right) \\
&= a E \textrm{e}^E.
\end{align*}
Now, this can be written as 
\begin{align*}
a h^2 \zeta^2 &= \exp \left( \frac{1}{h^2 \zeta^2}E - E \right), \\
\log \left( a h^2 \zeta^2 \right) &= E \left( \frac{1}{h^2 \zeta^2} - 1 \right).
\end{align*}
The energy of the pulse entering the gain fibre at equilibrium is thus
\begin{align*}
E = \frac{h^2 \zeta^2}{1 - h^2 \zeta^2} \log \left( a h^2 \zeta^2 \right).
\end{align*}
This expression allows us to determine a restriction on the parameters for a solution to exist---in order for this energy to be positive, $a h^2 \zeta^2 > 1$. The energy of the pulses as it enters the optical coupler can now be found, recall from \eqref{eq:gainde} that the energy is defined as
\begin{align*}
E = \int_{-\infty}^\infty |A|^2 \, \df T;
\end{align*}
the energy entering the optical coupler is then
\begin{align}
\nonumber E_* &= \int_{-\infty}^\infty |G(A)|^2 \, \df T, \\
\nonumber &= \frac{W(a E \textrm{e}^E)}{E} \int_{-\infty}^\infty |A|^2 \, \df T, \\
&= W(a E \textrm{e}^E).
\end{align}

We can now find the amplitude of the pulse as well as we have previously found the equilibrium shape. Again, from \eqref{eq:gainde}, it must be that $E_* = P \sigma \sqrt{\pi}$, or,
\begin{align}
P = \frac{W(a E \textrm{e}^E)}{\sigma \sqrt{\pi}}.
\end{align}
