\documentclass[12pt]{article}

\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{geometry}
\usepackage{xcolor,graphicx}
\usepackage[subfolder,cleanup]{gnuplottex}
%\usepackage{amsthm}
%\usepackage{enumitem}
%\usepackage{wrapfig}
%\usepackage{subcaption}
\usepackage{hyperref}
\usepackage{biblatex}

\bibliography{Ref.bib}

\newcommand{\diff}[3][]{\frac{d^{#1}#2}{d{#3}^{#1}}}
\newcommand{\pdiff}[3][]{\frac{\partial^{#1}#2}{\partial{#3}^{#1}}}
\newcommand{\Es}{E_{sat}}
\newcommand{\FT}[1]{\mathcal{F}\left\{ #1 \right\}}
\newcommand{\FTi}[1]{\mathcal{F}^{-1}\left\{ #1 \right\}}

\title{}
\author{Brady Metherall}

\newgeometry{margin=1in}
\setlength\parindent{0pt}

\begin{document}
\maketitle

\section{Model}
The laser cavity is treated as the composition of five independent process---gain, nonlinearity, loss, dispersion, and modulation. Expressions for each component will be derived from the  generalized nonlinear Schr\"{o}dinger equation \cite{agrawal2013, ferreira, shtyrina, yarutkina},
\begin{align}
\label{eq:nlse}
\pdiff{A}{z} = - i \frac{1}{2} \beta_2 \pdiff[2]{A}{T} + \frac{1}{6} \beta_3 \pdiff[3]{A}{T} + i \gamma |A|^2 A + \frac{1}{2}g(A) A - \alpha A,
\end{align}
where $A$ is the complex amplitude of the pulse, $\beta_2$ and $\beta_3$ are the second and third order dispersion coefficients respectively, $\gamma$ is the coefficient of nonlinearity, $g(A)$ is the gain, and $\alpha$ is the loss of the fiber.

\subsection{Gain}
Within the Er-doped gain fiber the other four processes are assumed to be negligible, and so \eqref{eq:nlse} reduces to
\begin{align}
\label{eq:gainde}
\pdiff{A}{z} = \frac{1}{2} g(A) A
\end{align}
with
\begin{align*}
g(A) &= \frac{g_0}{1 + E / \Es},
\end{align*}
where $g_0$ is a small signal gain, $\Es$ is the energy at which the gain begins to saturate, and \begin{align*}
E = \int_{-\infty}^\infty |A|^2 \, dT,
\end{align*}
is the energy of the pulse \cite{bohun, burgoyne2014, shtyrina, silfvast, yarutkina}. We shall first transform \eqref{eq:gainde} into an equation in terms of the energy. Taking
\begin{align*}
\pdiff{A}{z} = \frac{1}{2} \cdot \frac{g_0 A}{1 + E / \Es},
\end{align*}
multiplying by $\bar{A}$, the complex conjugate of $A$, and then adding the complex conjugate gives
\begin{align*}
\diff{|A|^2}{z} &= \frac{g_0 |A|^2}{1 + E / \Es},
\end{align*}
which after integrating becomes
\begin{align*}
\diff{E}{z} &= \frac{g_0 E}{1 + E / \Es}.
\end{align*}
For $E \ll \Es$ the energy grows exponentially, whereas for $E \gg \Es$ the gain has saturated and so the energy grows linearly. A closed form of the energy can be found by separating and integrating yielding
\begin{align}
\label{eq:energy}
E(z) = \Es W_0 \left( \frac{E_0}{\Es} e^{E_0 / \Es} e^{g_0 z} \right),
\end{align}
where $W_0$ is the Lambert $W$ function. However, only the exiting energy is of interest, thus \eqref{eq:energy} can be written as
\begin{align*}
E' = \Es W_0 \left( \frac{E}{\Es} e^{E / \Es} e^{g_0 L_g} \right),
\end{align*}
where $E$ is the energy of the incoming pulse, and $E'$ is the energy after traveling through the length of the gain fiber. Since $E \sim |A|^2$ the gain in terms of the amplitude is given by
\begin{align}
\label{eq:gain}
G(A) &= \left[ \frac{\Es}{E} W_0 \left( \frac{E}{\Es} e^{E / \Es} e^{g_0 L_g} \right) \right]^{1/2} A.
\end{align}

\subsection{Nonlinearity of Fiber}
The effect of the nonlinearity of the fiber can also be found from \eqref{eq:nlse}:
\begin{align*}
\pdiff{A}{z} - i \gamma |A|^2 A = 0,
\end{align*}
which similarly to the gain, can be transformed by multiplying by the complex conjugate of $A$, and adding its complex conjugate gives
\begin{align}
\label{eq:fibre}
\pdiff{|A|^2}{z} &= 0.
\end{align}
This suggests the envelope of the pulse does not change as it travels through the fiber---a solution of the form $A = A_0 e^{i \varphi}$ can be assumed. Substituting this expression into \eqref{eq:fibre} gives $\varphi = \gamma |A|^2 z$ therefore
\begin{align*}
F(A) &= A e^{i \gamma |A|^2 L_f},
\end{align*}
where $L_f$ is the length of the fiber.

\subsection{Loss}
Two sources of loss exist within the laser circuit: the loss due to the output coupler and the optical loss due to the circuit. The loss is then given as
\begin{align*}
L(A) &= C e^{- \alpha L}A,
\end{align*}
where $C$ is the loss due to the output coupler.

\subsection{Dispersion}
The dominant dispersion is due to the chirped fiber Bragg grating (CFBG). The dispersion due to the fiber is negligible in comparison---a $10$cm chirped grating can provide as much dispersion as $300$km of fiber \cite{agrawal2002}. The dispersive terms of \eqref{eq:nlse} give
\begin{align}
\label{eq:disp}
\pdiff{A}{z} = -i \frac{1}{2} \beta_2 \pdiff[2]{A}{T} + \frac{1}{6} \beta_3 \pdiff[3]{A}{T},
\end{align}
however, the third order effects of dispersion will be neglected \cite{agrawal2013, ferreira}. Although, under some circumstances they may need to be considered since the grating is highly dispersive \cite{agrawal2013, litchinitser}. Taking the Fourier transform of \eqref{eq:disp} gives
\begin{align*}
\pdiff{\FT{A}}{z} &= \frac{1}{2} i \beta_2 \omega^2 \FT{A}.
\end{align*}
The Fourier transform of $A$ can be found by integrating and thus,
\begin{align*}
D(A) &= \FTi{e^{i \frac{1}{2} \beta_2 \omega^2 L_D} \FT{A}}
\end{align*}
is the effect of the grating on the pulse.

\subsection{Modulation}
Pick a function that is bump-like, infinitely differentiable (I don't know how important that is), and has a maximum of $1$. We shall pick
\begin{align*}
M(A) &= e^{-T^2 / 2 T_M^2} A,
\end{align*}
where $T_M$ is a characteristic width of the modulation, since its Fourier transform is itself. ***I don't know how to write this.

\subsection{Non-Dimensionalization}
The structure of each process of the laser can be better understood by re-scaling the time, energy, and amplitude. Specifically, the time shall be scaled by the characteristic modulation time, the energy by the saturation energy, and the amplitude will be scaled so that it is consistent:
\begin{align*}
T = T_M \widetilde{T}, \quad E = \Es \widetilde{E}, \quad A = \left( \frac{\Es}{T_M} \right)^{1/2} \widetilde{A}.
\end{align*}
The new process maps, after dropping the tildes, become
\begin{align*}
G(A) &= \left( \frac{W_0 \left( a E e^{E}\right)}{E} \right)^{1/2} A, \\
F(A) &= A e^{i b |A|^2}, \\
L(A) &= h A, \\
D(A) &= \FTi{e^{i s^2 \omega^2} \FT{A}}, \\
M(A) &= e^{-T^2 / 2} A,
\end{align*}
with the dimensionless parameters
\begin{align*}
a = e^{g_0 L_g} \sim 30, \quad s = \sqrt{\frac{\beta_2 L_D}{2 T_M^2}} \sim 0.1, \quad b = \gamma L_F \frac{\Es}{T_M} \sim 0.1, \quad h = C e^{-\alpha L} \sim 0.25,
\end{align*}
which control the behaviour of the laser.

\subsection{Combining the Pieces}

\begin{align*}
\mathcal{L}(A) = M(D(L(F(G(A)))))
\end{align*}

A solution such that $|\mathcal{L}(A)|^2 = |A|^2$ is sought.

\section{Results}
\subsection{Linear Solution}
Suppose an initial pulse with envelope
\begin{align*}
|A_0| = \sqrt{P} e^{-x^2 / 2 \sigma^2},
\end{align*}
the after passing through the gain and loss pieces, and neglecting the fibre nonlinearity, the envelope will be
\begin{align*}
|A| = \sqrt{P} g(E) h e^{-x^2 / 2 \sigma^2},
\end{align*}
where
\begin{align*}
g(E) = \left( \frac{W_0(a E e^E)}{E} \right)^{1/2}
\end{align*}
is the gain component. After the pulse travels through the grating, the envelope will maintain its Gaussian shape, however, it will have spread. This can be represented as
\begin{align*}
|A| = \sqrt{P} g(E) h \zeta(s, b) e^{-x^2 / 2 \tilde{\sigma}^2}
\end{align*}
where $\zeta(s, b)$ represents the decrease in the amplitude and $\widetilde{\sigma}^2$ is the new variance. Although, note that the dispersive element conserves energy, thus,
\begin{align*}
\int_{-\infty}^{\infty} P g(E)^2 h^2 e^{-x^2 / \sigma^2} \, dx = \int_{-\infty}^{\infty} P g(E)^2 h^2 \zeta^2(s, b) e^{-x^2 / \widetilde{\sigma}^2} \, dx,
\end{align*}
or more simply
\begin{align*}
\sigma = \zeta^2(s, b) \widetilde{\sigma}.
\end{align*}
Therefore, the envelope as the pulse exits the grating is
\begin{align*}
|A| = \sqrt{P} g(E) h \zeta(s, b) \exp \left( -\zeta^4(s, b) \frac{x^2}{2 \sigma^2} \right).
\end{align*}
Lastly, the pulse is modulated and so
\begin{align*}
|A| = \sqrt{P} g(E) h \zeta(s, b) \exp \left( -\zeta^4(s, b) \frac{x^2}{2 \sigma^2} - \frac{x^2}{2} \right).
\end{align*}
In equilibrium the envelope of the pulse is unchanged after passing through each element, in other words,
\begin{align*}
\sqrt{P} e^{-x^2 / 2 \sigma^2} =  \sqrt{P} g(E) h \zeta(s, b) \exp \left( -\zeta^4(s, b) \frac{x^2}{2 \sigma^2} - \frac{x^2}{2} \right).
\end{align*}
For this to be the case 
\begin{align}
\label{eq:energycond}
\left( \frac{W_0(a E e^E)}{E} \right)^{1/2} h \zeta(s, b) = 1,
\end{align}
as well as
\begin{align*}
-x^2 / 2 \sigma^2 = -\zeta^4(s, b) \frac{x^2}{2 \sigma^2} - \frac{x^2}{2},
\end{align*}
which reduces to
\begin{align*}
\sigma = \sqrt{1 - \zeta^4(s, b)}.
\end{align*}

\begin{align*}
P = \frac{E}{\sqrt{\pi} \sigma}
\end{align*}

From \eqref{eq:energycond} the equilibrium energy is found to be
\begin{align*}
E = \frac{\zeta^2(s, b) h^2}{1 - \zeta^2(s, b) h^2} \ln \left( a \zeta^2(s, b) h^2 \right).
\end{align*}


\begin{figure}[htbp]
\centering
\begin{gnuplot}[terminal=epslatex, terminaloptions={color size 6in,3.7in lw 3}]
f(x) = m * x + c
fit f(x) '../sdata.dat' u 1:(log($2)) via m, c
set grid
set ytics 0.1
set xl '$s$'
set yl rotate by 0 '$\zeta(s)$'
plot '../sdata.dat' u 1:2 w p pt 7 ps 0.2 t 'Data', \
exp(f(x)) dt 4 t '$\exp(-0.521294s + 0.00365752)$'
\end{gnuplot}
\caption{}
\label{fig:zeta}
\end{figure}



\begin{figure}[htbp]
\centering
\begin{gnuplot}[terminal=epslatex, terminaloptions={color size 6in,3.7in lw 3}]
S(x) = exp(-0.5131 * x + 0.00174)
E(x, y) = -y**2 * log(a * y**2 * S(x)**2) * S(x)**2 / (y**2 * S(x)**2 - 1)
a = 30

set grid

set pm3d map

set isosamples 100, 100
set hidden3d

set contour surface
set cntrparam levels incremental 0, 0.1, 1.5

set palette rgbformulae 22, 13, -31

set ytics 0.1
set xl '$s$'
set yl rotate by 0 '$h$'
set cbl rotate by 0 '$E$'
set xr [0:0.5]
set yr [0.3:0.6]

unset clabel

splot E(x, y) not

\end{gnuplot}
\caption{a=30}
\label{fig:}
\end{figure}


\begin{table}
\begin{tabular}{|l|l|}
\hline
Parameter & Value \\
\hline
$\beta_2^g L_D$ & $10$--$2000 \text{ps}^2$ \\
$g_0$ & $1$--$10 \text{m}^{-1}$ \\
$\beta_2^f$ & $20$--$50 \text{ps}^2/ \text{km}$ \\
$\gamma$ & $0.001$--$0.01 \text{W}^{-1} \text{m}^{-1}$ \cite{agrawal2013} \\
$\Es$ & $10^4 \text{pJ}$ \\
$L_G$ & $2$--$3 \text{m}$ \cite{burgoyne2014, shtyrina, yarutkina} \\
\hline
\end{tabular}
\caption{yes}
\end{table}


\newpage
\printbibliography
\end{document}
